<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setting up Neovim LSP</title>
	<link rel="stylesheet" href="/bundle.css">
	<link rel="stylesheet" href="/prism-rose-pine-main-alt.css">
  </head>
  <body>
	<article>
	<h1>Setting up Neovim LSP</h1>
	<code>Updated: 30/07/2023</code>
    <p>A goal of mine is to, by the end of the year, contribute to Neovim.</p>
<p><em>Or open a PR which is swiftly rejected.</em></p>
<h2>Why start with LSP?</h2>
<p>I use Packer to setup various plugins, notably lsp-zero and Mason, which
provide the bulk of my functionality, with Harpoon and Telescope for
maneuverability.</p>
<p>I have no idea how these plugins work.</p>
<p>When something breaks, I have no idea how to fix it, and am reliant on package maintainers.</p>
<p>This is not awful, after all, the maintainers know much more than me.</p>
<p>However, I would like to learn.</p>
<h2>What is an LSP?</h2>
<p>An LSP, or &quot;Language Server Protocol&quot;, allows a client (your editor) to communicate with
a Language Server.</p>
<p>This allows your editor to utilise the info returned to perform
actions such as: go-to-definition, rename, hover details, format, etc.</p>
<h2>Which LSPs do I need to setup?</h2>
<p>For my work, I will need to setup the following LSPs.</p>
<ul>
<li>Go</li>
<li>Lua</li>
<li>Typescript</li>
<li>Eslint</li>
<li>CSS</li>
<li>Prettier</li>
<li>PHP</li>
</ul>
<p>I won't setup all of these in this document, but my Neovim config is public.</p>
<h2>How to setup Neovim LSP without plugins</h2>
<p>It is remarkably straightforward to setup the LSP using the Neovim API.</p>
<ul>
<li>Create an LSP client</li>
<li>Attach the client to the current buffer</li>
</ul>
<h2>Create an LSP client</h2>
<p>The LSP client in Neovim defines and initiates the Language Server process.</p>
<p>Here is how I setup the LSP client ('gopls') for Go:</p>
<pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">-- Start an LSP client </span>
    name <span class="token operator">=</span> <span class="token string">'gopls'</span><span class="token punctuation">,</span> <span class="token comment">-- A unique name for this client</span>
    cmd <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'gopls'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">-- The terminal command which starts the LSP</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h3>Install the Go LSP</h3>
<p>This will not work if:</p>
<ul>
<li>'gopls' is not installed</li>
<li>'gopls' is not available on your path</li>
</ul>
<p><em>All command line code blocks are written as if they should be executed within Neovim</em>.</p>
<p>You should be able to execute in your command line:</p>
<pre class="language-zsh"><code class="language-zsh">:!which gopls</code></pre>
<p>It will return the install directory if it is installed and part of your PATH.</p>
<p>To get the best results within the rest of this article, you should create a main.go file
and fill it with <code>package main</code> and a main func.</p>
<h3>Create the LSP</h3>
<p>To create the LSP Client, you can run this command:</p>
<pre class="language-lua"><code class="language-lua"><span class="token punctuation">:</span>lua <span class="token operator">=</span>vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">'gopls'</span><span class="token punctuation">,</span> cmd <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'gopls'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>This should return 1 if successful.</p>
<p>To double-check, you can return the details of all active clients:</p>
<pre class="language-lua"><code class="language-lua"><span class="token punctuation">:</span>lua <span class="token operator">=</span>vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">get_active_clients</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>The data returned contains information about the client.</p>
<p>Find the id of the client with the name 'gopls'.</p>
<h2>Connect the client to the current buffer</h2>
<p>Now we just need to attach the client to the buffer.</p>
<p>We know our client id, and 0 is a shorthand for the active buffer,
so to attach it we can run:</p>
<pre class="language-lua"><code class="language-lua"><span class="token punctuation">:</span>lua vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">buf_attach_client</span><span class="token punctuation">(</span>buffer_name<span class="token punctuation">,</span> client_id<span class="token punctuation">)</span>
<span class="token punctuation">:</span>lua vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">buf_attach_client</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre>
<p>If the buffer is a go file, type some invalid code and you will see
errors and warnings appear inline.</p>
<p><img src="../img/go-lsp-errors.png" alt="Some error messages!"></p>
<p>In a simple project, you could also try some of the other lsp functionality,
such as:</p>
<ul>
<li>Go to definition <code>:lua lsp.vim.buf.definition()</code></li>
<li>Format the buffer <code>:lua lsp.vim.buf.buffer()</code></li>
<li>Display 'hoverable' symbol information <code>:lua lsp.vim.buf.hover()</code></li>
<li>Select an available code action <code>:lua lsp.vim.buf.code_action()</code></li>
</ul>
<p><em>You can easily see most of these commands by typing <code>:lua vim.lsp.buf.</code> and then
pressing tab.</em></p>
<h2>Automate LSP setup for filetype</h2>
<p>I want to automate LSP client creation and attachment to buffer.</p>
<p>I also want to attach the appropriate LSP's to the correct filetype.</p>
<h3>Create Neovim config file</h3>
<p>I created a 'lsp-go.lua' file in my lua/tjmblake directory, and made sure it
is required by init.lua.</p>
<h3>Create auto command</h3>
<p>I created an auto command, a command which triggers <em>automatically</em> on read /
write of a buffer.</p>
<p>I set the type of auto command to &quot;FileType&quot;, so I can set a pattern to
match against the file type. I set this to match for Go files.</p>
<p>If the pattern is matched, the callback is executed.</p>
<p>In this callback, I want to create my client and attach it to the active buffer.</p>
<pre class="language-lua"><code class="language-lua"><span class="token comment">-- lua/tjmblake/lsp-go.lua</span>
vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_create_autocmd</span><span class="token punctuation">(</span><span class="token string">"FileType"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">-- Create an autocommand for filetype</span>
	pattern <span class="token operator">=</span> <span class="token string">"go"</span><span class="token punctuation">,</span> <span class="token comment">-- Run callback when FileType == go</span>
	callback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- The callback is what we want to exec</span>
		<span class="token keyword">local</span> root_dir <span class="token operator">=</span> vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span> <span class="token comment">-- Find the root project directory</span>
			vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'go.mod'</span><span class="token punctuation">,</span> <span class="token string">'go.work'</span><span class="token punctuation">,</span> <span class="token string">'.git'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> upward <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token punctuation">)</span>
		<span class="token keyword">local</span> client <span class="token operator">=</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">-- Create the LSP client</span>
			name <span class="token operator">=</span> <span class="token string">'gopls'</span><span class="token punctuation">,</span>
			cmd <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'gopls'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			root_dir <span class="token operator">=</span> root_dir<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">buf_attach_client</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> client<span class="token punctuation">)</span> <span class="token comment">-- Attach client to current buffer</span>
	<span class="token keyword">end</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h3>What is the root_dir?</h3>
<p>You are probably wondering what this root_dir is for. As it was not used before.</p>
<p>The root dir is important. It references your project root.</p>
<p>When we configure this LSP to run on .go files, we want to make sure to reuse
the same LSP client / server instead of having a new LSP run for each file.</p>
<p>However, if I open a new go project in another buffer, I want a new client to be
created for that project.</p>
<p>The <code>vim.lsp.start</code> method takes care of this for us, so long as we provide a root_dir.</p>
<p><em>Warning: <code>vim.lsp.start_client</code> does not, and hands over the reigns entirely to you.</em></p>
<p>To get the root_dir, I use <code>vim.fs.find</code> to traverse my project until I find either a
go.mod, go.work or .git file/dir. I then use <code>vim.fs.dirname</code> to extract the directory
name.</p>
<h2>How can I edit .lua effectively?</h2>
<p>If would help if we had some formatting / diagnostics while creating these
auto commands in lua.</p>
<p>After installing lua-language-server, it is relatively easy to setup.</p>
<pre class="language-lua"><code class="language-lua"><span class="token comment">-- lua/tjmblake/lsp-lua.lua</span>
vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_create_autocmd</span><span class="token punctuation">(</span><span class="token string">"FileType"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	pattern <span class="token operator">=</span> <span class="token string">"lua"</span><span class="token punctuation">,</span>
	callback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">local</span> root_dir <span class="token operator">=</span> vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>
			vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
				<span class="token punctuation">{</span>
					<span class="token string">".luarc.json"</span><span class="token punctuation">,</span>
					<span class="token string">".luarc.jsonc"</span><span class="token punctuation">,</span>
					<span class="token string">".luacheckrc"</span><span class="token punctuation">,</span>
					<span class="token string">".stylua.toml"</span><span class="token punctuation">,</span>
					<span class="token string">"stylua.toml"</span><span class="token punctuation">,</span>
					<span class="token string">"selene.toml"</span><span class="token punctuation">,</span>
					<span class="token string">"selene.yml"</span><span class="token punctuation">,</span>
					<span class="token string">".git"</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> upward <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token punctuation">)</span>
		<span class="token keyword">local</span> client <span class="token operator">=</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			name <span class="token operator">=</span> <span class="token string">'lua-language-server'</span><span class="token punctuation">,</span>
			cmd <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'lua-language-server'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			root_dir <span class="token operator">=</span> root_dir<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">buf_attach_client</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> client<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>It is exactly the same procedure as before, with some alternate file types.</p>
<p><em>To be honest, I have never seen most of these file types before, but it can't hurt.</em></p>
<h3>Fixing Lua &quot;vim namespace not found&quot; type errors</h3>
<p>The Lua LSP connection now works, however, I would like it access to the Neovim
API code so I get more context when using the API.</p>
<p>The LSP cannot access this, as Vim is a global and the Neovim code is not within my
project directory.</p>
<p>To provide access, I looked at nvim-lspconfig to see how they implemented it.</p>
<p>There is a lot going on there, but I did take this declaration of settings.</p>
<p>Settings is passed to the vim.lsp.start function and can alter the client configuration.</p>
<pre class="language-lua"><code class="language-lua">settings <span class="token operator">=</span> <span class="token punctuation">{</span>
	Lua <span class="token operator">=</span> <span class="token punctuation">{</span>
		runtime <span class="token operator">=</span> <span class="token punctuation">{</span>
			version <span class="token operator">=</span> <span class="token string">"LuaJIT"</span><span class="token punctuation">,</span> <span class="token comment">-- Neovim uses LuaJIT</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		diagnostics <span class="token operator">=</span> <span class="token punctuation">{</span>
			globals <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"vim"</span> <span class="token punctuation">}</span> <span class="token comment">-- This makes the vim global namespace available</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		workspace <span class="token operator">=</span> <span class="token punctuation">{</span>
			library <span class="token operator">=</span> vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_get_runtime_file</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- This gets the Neovim runtime and adds it to our workspaces.</span>
			checkThirdParty <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		telemetry <span class="token operator">=</span> <span class="token punctuation">{</span>
			enable <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<p>This generally works well, but not all Vim APIs are available via omnifunc, cmp,
such as vim.lsp. I will fix this later when I handle completion (to be written).</p>
<p>The main thing is this removes the 'vim namespace not found' errors.</p>
<h2>Set up LSP for Typescript, Eslint</h2>
<p>This will require having the vscode extracted
<a href="https://github.com/hrsh7th/vscode-langservers-extracted">language servers</a> installed,
alongside typescript language server.</p>
<h3>Setup Typescript</h3>
<p>Setting up Typescript LSP is business as usual.</p>
<pre class="language-lua"><code class="language-lua"><span class="token comment">-- lua/tjmblake/lsp-typescript.lua</span>
vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_create_autocmd</span><span class="token punctuation">(</span><span class="token string">"FileType"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	pattern <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">'javascript'</span><span class="token punctuation">,</span>
		<span class="token string">'javascriptreact'</span><span class="token punctuation">,</span>
		<span class="token string">'javascript.jsx'</span><span class="token punctuation">,</span>
		<span class="token string">'typescript'</span><span class="token punctuation">,</span>
		<span class="token string">'typescriptreact'</span><span class="token punctuation">,</span>
		<span class="token string">'typescript.tsx'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	callback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">local</span> root_dir <span class="token operator">=</span> vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>
			vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'package.json'</span><span class="token punctuation">,</span> <span class="token string">'.git'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> upward <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token punctuation">)</span>
		<span class="token keyword">local</span> client <span class="token operator">=</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			name <span class="token operator">=</span> <span class="token string">'typescript-language-server'</span><span class="token punctuation">,</span>
			cmd <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'typescript-language-server'</span><span class="token punctuation">,</span> <span class="token string">'--stdio'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			root_dir <span class="token operator">=</span> root_dir<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">buf_attach_client</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> client<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h3>Setup Eslint</h3>
<p>Eslint was straightforward to setup. I went and borrowed the settings configuration
from nvim-lspconfig again.</p>
<pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_create_autocmd</span><span class="token punctuation">(</span><span class="token string">"FileType"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	pattern <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">'javascript'</span><span class="token punctuation">,</span>
		<span class="token string">'javascriptreact'</span><span class="token punctuation">,</span>
		<span class="token string">'javascript.jsx'</span><span class="token punctuation">,</span>
		<span class="token string">'typescript'</span><span class="token punctuation">,</span>
		<span class="token string">'typescriptreact'</span><span class="token punctuation">,</span>
		<span class="token string">'typescript.tsx'</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	callback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">local</span> root_dir <span class="token operator">=</span> vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>
			vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'.eslintrc'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> upward <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token punctuation">)</span>
		<span class="token keyword">local</span> client <span class="token operator">=</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			name <span class="token operator">=</span> <span class="token string">"eslint"</span><span class="token punctuation">,</span>
			cmd <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'vscode-eslint-language-server'</span><span class="token punctuation">,</span> <span class="token string">'--stdio'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			root_dir <span class="token operator">=</span> root_dir<span class="token punctuation">,</span>
			settings <span class="token operator">=</span> <span class="token punctuation">{</span>
				validate <span class="token operator">=</span> <span class="token string">'on'</span><span class="token punctuation">,</span>
				packageManager <span class="token operator">=</span> <span class="token string">'yarn'</span><span class="token punctuation">,</span>
				useESLintClass <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
				experimental <span class="token operator">=</span> <span class="token punctuation">{</span>
					useFlatConfig <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				codeActionOnSave <span class="token operator">=</span> <span class="token punctuation">{</span>
					enable <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
					mode <span class="token operator">=</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				format <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
				quiet <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
				onIgnoredFiles <span class="token operator">=</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
				rulesCustomizations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				run <span class="token operator">=</span> <span class="token string">'onType'</span><span class="token punctuation">,</span>
				problems <span class="token operator">=</span> <span class="token punctuation">{</span>
					shortenToSingleLine <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				nodePath <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
				workingDirectory <span class="token operator">=</span> <span class="token punctuation">{</span> mode <span class="token operator">=</span> <span class="token string">'location'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				codeAction <span class="token operator">=</span> <span class="token punctuation">{</span>
					disableRuleComment <span class="token operator">=</span> <span class="token punctuation">{</span>
						enable <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
						location <span class="token operator">=</span> <span class="token string">'separateLine'</span><span class="token punctuation">,</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					showDocumentation <span class="token operator">=</span> <span class="token punctuation">{</span>
						enable <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span><span class="token function">buf_attach_client</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> client<span class="token punctuation">)</span>
	<span class="token keyword">end</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>The reason I am showing these alternate configurations is to show that there are
only minor differences, specific to the LSP's root_dir pattern or settings.</p>
<p>Otherwise, it's fairly consistent.</p>
<p>This is because LSP is a protocol for communicating between a editor/client
and language server.</p>
<h2>Binding common LSP functions</h2>
<p>This article is not about setting up keybindings. For my own use, since I am used
to them, I have copied over the bindings from lsp-zero.</p>
<pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_create_autocmd</span><span class="token punctuation">(</span><span class="token string">"LspAttach"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	callback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
		<span class="token keyword">local</span> bufnr <span class="token operator">=</span> args<span class="token punctuation">.</span>buf
		<span class="token keyword">local</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> buffer <span class="token operator">=</span> bufnr<span class="token punctuation">,</span> remap <span class="token operator">=</span> <span class="token keyword">false</span> <span class="token punctuation">}</span>

		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"gd"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span>buf<span class="token punctuation">.</span>definition<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"K"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span>buf<span class="token punctuation">.</span>hover<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;leader>vws"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span>buf<span class="token punctuation">.</span>workspace_symbol<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;leader>vd"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>diagnostic<span class="token punctuation">.</span>open_float<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"[d"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>diagnostic<span class="token punctuation">.</span>goto_next<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"]d"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>diagnostic<span class="token punctuation">.</span>goto_prev<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;leader>vca"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span>buf<span class="token punctuation">.</span>code_action<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;leader>vrr"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span>buf<span class="token punctuation">.</span>references<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;leader>vrn"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span>buf<span class="token punctuation">.</span>rename<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
		vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"&lt;C-h>"</span><span class="token punctuation">,</span> vim<span class="token punctuation">.</span>lsp<span class="token punctuation">.</span>buf<span class="token punctuation">.</span>signature_help<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
	<span class="token keyword">end</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2>Summary</h2>
<p>Setting up these LSP clients within Neovim using the API is fairly straightforward.</p>
<p>The Neovim documentation is approachable using the :help vim.lsp command.</p>
<p>Now that I have a initial understanding of the API, <s>stealing</s> <em>taking
inspiration</em> from other LSP plugins (such as lsp-zero, nvim-lspconfig)
is much more approachable.</p>
<p>The ability to now look at other plugins and dive-deeper into the <em>why</em> will
be useful going forward. Even just for the small area I've covered so far.</p>
<p>While I use omnifunc a fair amount, lsp-zero provides a tight
integration with nvim-cmp for auto-completion.</p>
<p>I have not replicated this in the
article because I want to compare using Omnifunc for a while.</p>

	</article>
	<ul>
	</ul>
  </body>
</html>
